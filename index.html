<html lang="en" ng-app="app">
  <head>
    <meta name="viewport" content="initial-scale=1" />

    <title>glassic</title>

    <!-- Angular Material CSS now available via Google CDN; version 0.11 used here -->
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/0.11.1/angular-material.min.css">

    <style type="text/css" media="all">
      html, body {
        overflow: hidden;
      }

      md-card {
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>
  <body ng-controller="AppCtrl">
    <md-content class="md-padding">
      <md-card>
        <md-card-content>
          <h2 class="md-title">glassic</h2>
          <form name="myForm">
            <div layout="row" layout-sm="column" layout-wrap>
              <md-content flex layout="column" layout-align="center center">
                I want an application called
              </md-content>
              <md-input-container flex>
                <label>name</label>
                <input ng-required ng-model="config.name" ng-minlength="2" ng-maxlength="30" ng-pattern="/^[0-9A-Za-z\-\_]*$/">
              </md-input-container>
              <md-content flex layout="column" layout-align="center center">
                pointing to
              </md-content>
              <md-input-container flex>
                <label>url</label>
                <input ng-required type="url" ng-model="config.url">
              </md-input-container>
              <md-content layout="column" layout-align="center center">
                .
              </md-content>
            </div>
            <div layout="row" layout-sm="column" layout-wrap>
              <div flex layout="column" layout-align="center center">
                It should work on
              </div>
              <div flex>
                <md-checkbox ng-checked="android" ng-click="android = !android">
                  android
                </md-checkbox>
              </div>
              <div flex>
                <md-checkbox ng-checked="linux" ng-click="linux = !linux">
                  linux
                </md-checkbox>
              </div>
              <div flex>
                <md-checkbox ng-checked="windows" ng-click="windows = !windows">
                  windows
                </md-checkbox>
              </div>
              <div flex>
                <md-checkbox ng-checked="mac" ng-click="mac = !mac">
                  mac
                </md-checkbox>
              </div>
            </div>
          </form>
        </md-card-content>
        <div class="md-actions" layout="row" layout-align="end center">
          <md-button ng-click="generate()" ng-disabled="!myForm.$valid">Generate & Download</md-button>
        </div>
      </md-card>
    </md-content>

    <!-- Angular Material Dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>


    <!-- Angular Material Javascript now available via Google CDN; version 0.11 used here -->
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/0.11.1/angular-material.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js"></script>

    <script>
      var app = angular.module('app', ['ngMaterial']);

app.config(function($mdThemingProvider) {
  $mdThemingProvider.theme('default')
    .accentPalette('deep-purple');
});

app.controller('AppCtrl', ['$scope', '$mdToast', function($scope, $mdToast) {
  $scope.config = {
    name: 'CoolBeans',
    url: 'https://cool-beans.com/'
  };

  showToast = function (s) {
    $mdToast.show($mdToast.simple().content(s).position('bottom right').hideDelay(3000));
  }

  $scope.generate = function () {
    var zip = new JSZip();
    zip.folder($scope.config.name + "-glassic");
    zip.file($scope.config.name + '-glassic/generated-config.json', angular.toJson($scope.config));
    // TODO: fix this
    zip.file($scope.config.name + '-glassic/start.sh', '#!/usr/bin/env sh\n\ngit clone git@github.com:mess110/glassic.git\nmv glassic/* .\nmv glassic/.* .\nrmdir glassic/\nmv generated-config.json config.json\nnpm install\ngrunt compile\n');
    var content = zip.generate({type: 'blob'});
    saveAs(content, $scope.config.name + '-glassic.zip');

    showToast('App generated.');
  };
}]);
    </script>
  </body>
</html>
